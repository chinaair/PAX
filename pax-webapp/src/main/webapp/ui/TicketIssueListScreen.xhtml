<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
        xmlns:ui="http://java.sun.com/jsf/facelets"
        xmlns:h="http://java.sun.com/jsf/html"
        xmlns:f="http://java.sun.com/jsf/core"
        xmlns:p="http://primefaces.org/ui"
        xmlns:pe="http://primefaces.org/ui/extensions"
        template="pageWithMenu.xhtml">
	<ui:define name="content">
		<f:event type="preRenderView" listener="#{ticketIssueBean.startConversation}" />
		<h1 class="title ui-widget-header ui-corner-all"><h:outputText value="#{message.ticketIssue_header}" /></h1>
		<h:panelGroup styleClass="entry" layout="block">
			<p:messages id="messages" showDetail="false" autoUpdate="true" closable="false" />
			<p:toolbar>
				<p:toolbarGroup align="left">
					<p:commandButton value="New" icon="ui-icon-plusthick" action="#{ticketIssueBean.gotoNewTicketIssueScreen}" ajax="false" onclick="PF('statusDialog').show();" />
					<p:commandButton value="View" icon="ui-icon-document" action="#{ticketIssueBean.gotoViewTicketIssueScreen}" ajax="false" onclick="PF('statusDialog').show();" />
					<p:commandButton value="Print" icon="ui-icon-clipboard" action="#{ticketIssueBean.printTicketIssueInfo}" ajax="false" />
					<p:commandButton value="Search All" icon="ui-icon-search" action="#{ticketIssueBean.searchTicketIssue(true)}" ajax="false" onclick="PF('statusDialog').show();" />
				</p:toolbarGroup>
			</p:toolbar>
			
			<p:panel header="Search condition" toggleable="true" toggleSpeed="500" closeSpeed="500" widgetVar="panel" collapsed="false" style="margin-top:10px">
				<table border="0" cellspacing="0" cellpadding="0" width="100%">
					<tr>
						<td><p:outputLabel for="searhStart" value="Start date:" /></td>
						<td><p:calendar id="searhStart" value="#{ticketIssueBean.searchStartDate}" showOn="button" pattern="dd/MM/yyyy" /></td>
						<td><p:outputLabel for="searhEnd" value="End date:" /></td>
						<td><p:calendar id="searhEnd" value="#{ticketIssueBean.searchEndDate}" showOn="button" pattern="dd/MM/yyyy" /></td>
						<td><p:outputLabel for="searchRefNo" value="Refer number:" /></td>
						<td><p:inputText id="searchRefNo" value="#{ticketIssueBean.searchRefNo}" label="Search refer number" /></td>
					</tr>
					<tr>
						<td><p:outputLabel for="searchAgent" value="Agent" /></td>
						<td>
							<h:panelGroup>
								<p:inputMask id="agentCode" value="#{ticketIssueBean.searchAgentCode}" mask="999-9999" size="8">
									<p:ajax event="blur" listener="#{ticketIssueBean.onInputSearchAgentCodeBlur}" update="searchAgent" />
								</p:inputMask>
								<p:inputText id="searchAgent" value="#{ticketIssueBean.searchAgentName}" label="Agent" readonly="true" />
								<p:commandButton icon="ui-icon-extlink" actionListener="#{ticketIssueBean.chooseAgent}">
									<p:ajax event="dialogReturn" listener="#{ticketIssueBean.onSearchAgentChosen}" update="searchAgent,agentCode" />
								</p:commandButton>
							</h:panelGroup>
						</td>
						<td><p:outputLabel for="searchStatus" value="Status" /></td>
						<td>
							<p:selectOneMenu id="searchStatus" value="#{ticketIssueBean.searchStatus}">
								<f:selectItem itemLabel="All" itemValue="ALL" />
					            <f:selectItem itemLabel="No tax invoice" itemValue="0" />
					            <f:selectItem itemLabel="Has tax invoice" itemValue="1" />
					            <f:selectItem itemLabel="Voided" itemValue="2" />
					            <f:selectItem itemLabel="Saved" itemValue="3" />
					        </p:selectOneMenu>
						</td>
						<td><p:outputLabel for="searchStatus" value="Ticket No." /></td>
						<td><p:inputText id="ticketNo" value="#{ticketIssueBean.searchTicketNo}" label="Search ticket number" /></td>
					</tr>
					<tr>
						<td><p:outputLabel for="inputSD" value="Input SD" /></td>
						<td><p:inputText id="inputSD" value="#{ticketIssueBean.searchInputSD}" label="Input SD" /></td>
						<td><p:outputLabel for="inputRoute" value="Input Route" /></td>
						<td><p:inputText id="inputRoute" value="#{ticketIssueBean.searchRoute}" label="Input Route" /></td>
						<td align="left" colspan="2">
							<p:commandButton value="Clear" icon="ui-icon-refresh" action="#{ticketIssueBean.clearSearch}" ajax="false" onclick="PF('statusDialog').show();" />
							<p:commandButton value="Search" icon="ui-icon-search" action="#{ticketIssueBean.searchTicketIssue(false)}" ajax="false" onclick="PF('statusDialog').show();" />
						</td>
					</tr>
				</table>
			</p:panel>
			<p:dataTable var="detail" value="#{ticketIssueBean.ticketIssueList}" rowKey="#{detail.id}" style="margin-top:10px"
                selection="#{ticketIssueBean.selectedTicketIssue}" 
				paginator="true" rows="15"
                 paginatorTemplate="{RowsPerPageDropdown} {FirstPageLink} {PreviousPageLink} {CurrentPageReport} {NextPageLink} {LastPageLink}"
                 rowsPerPageTemplate="5,10,15" selectionMode="single" id="ticketIssueTable" lazy="true">
				<f:facet name="header">
		           #{message.ticketIssue_list_header}
		        </f:facet>
				<p:column headerText="Issue date" sortBy="#{detail.issueDate}" >
		            <h:outputText value="#{detail.issueDate}">
		            	<f:convertDateTime pattern="dd/MM/yy" />
		            </h:outputText>
		        </p:column>
		        
		        <p:column headerText="Refer Number" sortBy="#{detail.id}">
		            #{detail.formattedId}
		        </p:column>
		        
		        <p:column headerText="Agent">
		            #{detail.agent.name}
		        </p:column>
		        
		        <p:column headerText="Amount USD" sortBy="#{detail.amountUsd}">
		            <h:outputText value="#{detail.amountUsd}">
		            	<f:convertNumber pattern="#,##0.00" />
		            </h:outputText>
		        </p:column>
		        
		        <p:column headerText="Status" sortBy="#{detail.status}">
		            <h:outputText rendered="#{detail.status=='0'}" value="No tax invoice"/>
		            <h:outputText rendered="#{detail.status=='1'}" value="Has tax invoice"/>
		            <h:outputText rendered="#{detail.status=='3'}" value="Saved"/>
		            <h:outputText rendered="#{detail.status=='2'}" value="Voided"/>
		        </p:column>
		        
			</p:dataTable>
			
			<p:toolbar style="margin-top:10px;">
				<p:toolbarGroup align="left">
					<p:commandButton value="New" icon="ui-icon-plusthick" action="#{ticketIssueBean.gotoNewTicketIssueScreen}" ajax="false" onclick="PF('statusDialog').show();" />
					<p:commandButton value="View" icon="ui-icon-document" action="#{ticketIssueBean.gotoViewTicketIssueScreen}" ajax="false" onclick="PF('statusDialog').show();" />
					<p:commandButton value="Print" icon="ui-icon-clipboard" action="#{ticketIssueBean.printTicketIssueInfo}" ajax="false" />
					<p:commandButton value="Search All" icon="ui-icon-search" action="#{ticketIssueBean.searchTicketIssue(true)}" ajax="false" onclick="PF('statusDialog').show();" />
				</p:toolbarGroup>
			</p:toolbar>
		</h:panelGroup>
			
	</ui:define>
</ui:composition>